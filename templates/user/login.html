<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>키즈랜드 실내놀이터 신청</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>

</head>
<body style="max-width: 900px; margin: 0 auto;display: block;">

<h1 style="text-align: center">문자 인증 하기</h1>
<br></br>

<div class="input-phone-number"
     style="width: 90%; display: flex; justify-content: center; align-items: center; margin: 0 auto;">
    <input type="text" class="form-control" id="phone_number" placeholder="휴대폰 번호를 입력해주세요"
           aria-label="Recipient's username"
           aria-describedby="button-addon2" style="flex: 1; box-sizing: border-box;">
    <button class="btn btn-outline-secondary" type="button" id="button-addon1"
            style="flex: 0 0 10%; box-sizing: border-box;">인증번호 전송
    </button>
</div>

<br></br>

<div class="input-security-number"
     style="width: 90%; display: flex; justify-content: center; align-items: center; margin: 0 auto;">
    <input type="text" class="form-control" id="input_security_number" placeholder="인증 번호를 입력해주세요!"
           aria-label="Recipient's username"
           aria-describedby="button-addon2" style="flex: 1; box-sizing: border-box;">
    <button class="btn btn-outline-secondary" type="button" id="button-addon2"
            style="flex: 0 0 10%; box-sizing: border-box;">인증하기
    </button>
</div>

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

<script>
    let securityNumber;  // 변수를 전역으로 선언하여 두 이벤트 핸들러에서 접근 가능하게 함

    $('#button-addon1').click(function () {
        alert("인증 번호를 보냅니다");

        let phone_number = $('#phone_number').val();

        $.ajax({
            url: "/user/login",
            data: {
                phone_number: phone_number,
            },
            method: "POST",
            success: function (response) {
                console.log("성공");
                securityNumber = response.security_number;  // 전역 변수에 저장
            },
            error: function (error) {
                console.error("Error:", error);
            },
            complete: function () {
                console.log("완료");
            }
        });
    });

    $('#button-addon2').click(function () {
        let input_security_number = $('#input_security_number').val();

        if (input_security_number === securityNumber) {
            // 인증 성공
            alert("인증 성공");
            {#location.replace('checkIn');#}
            window.location.href = "checkIn";
        } else {
            // 인증 실패
            alert("인증 실패");
        }
    });

</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
</body>
</html>